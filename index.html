<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Arthur & Jojo - Site</title>
  <script src="https://www.gstatic.com/firebasejs/9.30.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.30.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.30.0/firebase-database-compat.js"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg,#111,#222); color:#fff; cursor: url('https://cdn.iconscout.com/icon/free/png-256/magic-wand-107967.png'), auto; }
    header { padding: 1rem; display: flex; justify-content: space-between; align-items: center; background: linear-gradient(90deg,#222,#444); }
    header .logo { font-size: 2rem; background: linear-gradient(90deg,#ff5f6d,#ffc371); -webkit-background-clip: text; -webkit-text-fill-color: transparent;}
    nav { position: relative; }
    .menu-btn { background:#333; border:none; padding:0.5rem 1rem; border-radius:8px; cursor:pointer; transition:0.3s; }
    .menu-btn:hover { background:#555; }
    .dropdown { position: absolute; right: 0; top: 2.5rem; background:#222; border-radius:8px; overflow:hidden; display:none; box-shadow: 0 4px 10px rgba(0,0,0,0.5); }
    .dropdown.show { display: block; }
    .dropdown button { display: block; width: 100%; padding: 0.7rem 1rem; background: none; border: none; color: #fff; text-align: left; cursor: pointer; transition: 0.2s; }
    .dropdown button:hover { background: #444; }

    .container { max-width: 1000px; margin: 2rem auto; padding: 1rem; }
    section { margin-bottom: 2rem; padding: 1rem; background: #1a1a1a; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.5); }
    h2 { margin-bottom: 1rem; background: linear-gradient(90deg,#ff5f6d,#ffc371); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

    .video-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px,1fr)); gap:1rem; }
    .video-card { background:#222; padding:1rem; border-radius:8px; transition:0.3s; }
    .video-card:hover { transform: translateY(-5px); box-shadow: 0 0 20px rgba(255,255,255,0.2); }
    .video-card iframe { width:100%; height:180px; border-radius:6px; }

    #tickets { display: flex; flex-direction: column; gap:1rem; }
    .ticket { background:#333; padding:1rem; border-radius:8px; position: relative; }
    .ticket-header { display: flex; justify-content: space-between; align-items: center; }
    .ticket-body { max-height:180px; overflow-y: auto; background:#222; padding:0.5rem; border-radius:6px; margin-top:0.5rem; }
    .ticket-body p { margin-bottom:0.5rem; }
    .ticket-input { display: flex; gap:0.5rem; margin-top:0.5rem; }
    .ticket-input input { flex:1; padding:0.5rem; border-radius:6px; border:none; background:#1a1a1a; color:#fff; }
    .ticket-input button { padding:0.5rem 1rem; border:none; border-radius:6px; background: linear-gradient(90deg,#ff5f6d,#ffc371); color:#000; font-weight:bold; transition:0.3s; }
    .ticket-input button:hover { opacity:0.8; }

    #adminPanel { display:none; background:#222; padding:1rem; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.7); }
    #adminPanel h3 { margin-bottom:1rem; }
    #adminPanel input, #adminPanel textarea { width:100%; margin-bottom:1rem; padding:0.7rem; border-radius:6px; border:none; background:#111; color:#fff; }
    #adminPanel button { padding:0.7rem 1rem; border:none; border-radius:6px; background: linear-gradient(90deg,#ff5f6d,#ffc371); color:#000; font-weight:bold; transition:0.3s; }
    #adminPanel button:hover { opacity:0.8; }

    .emoji { display: inline-block; animation: pulse 2s infinite; }
    @keyframes pulse { 0%,100% { transform: scale(1); } 50% { transform: scale(1.2); } }

    footer { text-align:center; padding:1rem; margin-top:2rem; color:#aaa; }
  </style>
</head>
<body>

<header>
  <div class="logo">Arthur & Jojo ‚ù§</div>
  <nav>
    <button class="menu-btn" onclick="toggleMenu()">‚ò∞ Se connecter</button>
    <div class="dropdown" id="menuDropdown">
      <button onclick="loginUser()">Utilisateur (Google)</button>
      <button onclick="loginAdmin()">Acc√®s administratif</button>
    </div>
  </nav>
</header>

<div class="container">
  <section id="videosSection">
    <h2>üì∫ Vid√©os</h2>
    <div class="video-list" id="videoList"></div>
  </section>

  <section id="annoncesSection">
    <h2>üì¢ Annonces</h2>
    <div id="annoncesList"></div>
  </section>

  <section id="ticketsSection">
    <h2>üé´ Tickets</h2>
    <button class="styled" onclick="openTicket()">‚ûï Cr√©er un ticket</button>
    <div id="tickets"></div>
  </section>

  <div id="adminPanel">
    <h3>üîß Panel Admin</h3>

    <h4>Ajouter Vid√©o</h4>
    <input type="text" id="videoUrl" placeholder="Lien YouTube (embed)">
    <textarea id="videoDesc" placeholder="Description"></textarea>
    <button onclick="adminAddVideo()">Ajouter vid√©o</button>

    <h4>Ajouter Annonce</h4>
    <textarea id="annonceText" placeholder="√âcrire annonce"></textarea>
    <button onclick="adminAddAnnonce()">Ajouter annonce</button>

    <h4>G√©rer Tickets</h4>
    <div id="adminTickets"></div>
  </div>
</div>

<footer>Cod√© par Jojo fait avec le <span class="emoji">‚ù§</span></footer>

<script>
  // ========== Firebase config ==========
  const firebaseConfig = {
    apiKey: "VOTRE_API_KEY",
    authDomain: "VOTRE_PROJET.firebaseapp.com",
    databaseURL: "https://VOTRE_PROJET.firebaseio.com",
    projectId: "VOTRE_PROJET",
    storageBucket: "VOTRE_PROJET.appspot.com",
    messagingSenderId: "SENDER_ID",
    appId: "APP_ID"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.database();

  let currentUser = null;
  let isAdmin = false;

  // ========== Menu Connexion ==========
  function toggleMenu(){
    document.getElementById('menuDropdown').classList.toggle('show');
  }
  window.onclick = e => {
    if (!e.target.matches('.menu-btn')) {
      document.getElementById('menuDropdown').classList.remove('show');
    }
  };

  // ========== Connexion Google ==========
  function loginUser(){
    const provider = new firebase.auth.GoogleAuthProvider();
    auth.signInWithPopup(provider)
      .then(result => {
        currentUser = result.user;
        alert("Connect√© en tant que " + result.user.displayName);
        loadData();
        showAdminIfNeeded();
      })
      .catch(error => {
        console.error("Erreur Google Login", error);
      });
  }

  // ========== Admin Login ==========
  function loginAdmin(){
    const code = prompt("Entrez le code admin :");
    if(code === "2516"){
      isAdmin = true;
      document.getElementById('adminPanel').style.display = "block";
      loadData();
      alert("Acc√®s admin activ√© !");
    } else {
      alert("Code incorrect !");
    }
  }

  // ========== Vid√©os ==========
  function adminAddVideo(){
    if(!isAdmin) return alert("Acc√®s admin requis");
    const url = document.getElementById('videoUrl').value;
    const desc = document.getElementById('videoDesc').value;
    const key = db.ref('videos').push().key;
    db.ref('videos/' + key).set({ url, desc });
    document.getElementById('videoUrl').value = "";
    document.getElementById('videoDesc').value = "";
  }

  function renderVideos(videos){
    const list = document.getElementById('videoList');
    list.innerHTML = "";
    for(let key in videos){
      const v = videos[key];
      const div = document.createElement('div');
      div.className = "video-card";
      div.innerHTML = `<iframe src="${v.url}" frameborder="0" allowfullscreen></iframe>
                       <p>${v.desc || ''}</p>`;
      list.appendChild(div);
    }
  }

  db.ref('videos').on('value', snapshot => {
    const data = snapshot.val() || {};
    renderVideos(data);
  });

  // ========== Annonces ==========
  function adminAddAnnonce(){
    if(!isAdmin) return alert("Acc√®s admin requis");
    const text = document.getElementById('annonceText').value;
    const key = db.ref('annonces').push().key;
    db.ref('annonces/' + key).set({ text });
    document.getElementById('annonceText').value = "";
  }

  function renderAnnonces(annonces){
    const list = document.getElementById('annoncesList');
    list.innerHTML = "";
    for(let key in annonces){
      const a = annonces[key];
      const div = document.createElement('div');
      div.className = "annonce";
      div.innerHTML = `<span>${a.text}</span>` + (isAdmin ? ` <button onclick="deleteAnnonce('${key}')">‚ùå</button>` : "");
      list.appendChild(div);
    }
  }

  function deleteAnnonce(key){
    if(!isAdmin) return;
    db.ref('annonces/' + key).remove();
  }

  db.ref('annonces').on('value', snapshot => {
    const data = snapshot.val() || {};
    renderAnnonces(data);
  });

  // ========== Tickets ==========
  function openTicket(){
    if(!currentUser) return alert("Vous devez √™tre connect√© !");
    const key = db.ref('tickets').push().key;
    db.ref('tickets/' + key).set({ user: currentUser.uid, messages: {} });
  }

  function renderTickets(tickets){
    const userDiv = document.getElementById('tickets');
    const adminDiv = document.getElementById('adminTickets');
    userDiv.innerHTML = ""; adminDiv.innerHTML = "";

    for(let key in tickets){
      const t = tickets[key];
      // Si c'est le ticket de l'utilisateur OU admin
      if(t.user === (currentUser && currentUser.uid) || isAdmin){
        // Cr√©ation UI ticket
        const div = document.createElement('div');
        div.className = "ticket";
        const messagesHtml = Object.entries(t.messages || {}).map(([mkey, m]) => `<p>${m.from}: ${m.text} ${isAdmin?`<button onclick="deleteMessage('${key}','${mkey}')">üóëÔ∏è</button>`:""}</p>`).join("");
        div.innerHTML = `
          <div class="ticket-header"><span>Ticket ${key}</span></div>
          <div class="ticket-body">${messagesHtml}</div>
          <div class="ticket-input">
            <input id="input-${key}" placeholder="Votre message...">
            <button onclick="sendMessage('${key}')">Envoyer</button>
          </div>
        `;
        userDiv.appendChild(div);

        if(isAdmin){
          const div2 = div.cloneNode(true);
          adminDiv.appendChild(div2);
        }
      }
    }
  }

  function sendMessage(ticketKey){
    const inp = document.getElementById('input-' + ticketKey);
    const text = inp.value.trim();
    if(!text) return;
    const msgKey = db.ref('tickets/' + ticketKey + '/messages').push().key;
    db.ref('tickets/' + ticketKey + '/messages/' + msgKey).set({ text, from: currentUser.displayName || 'Utilisateur' });
    inp.value = "";
  }

  function deleteMessage(ticketKey, msgKey){
    if(!isAdmin) return;
    db.ref('tickets/' + ticketKey + '/messages/' + msgKey).remove(); // suppression via Firebase :contentReference[oaicite:0]{index=0}
  }

  db.ref('tickets').on('value', snapshot => {
    const data = snapshot.val() || {};
    renderTickets(data);
  });

  // ========== Initial Load ==========
  auth.onAuthStateChanged(user => {
    currentUser = user;
    loadData();
    showAdminIfNeeded();
  });

  function loadData(){
    // Recharger donn√©es annonces, vid√©os, tickets
    // Les listeners Firebase sont d√©j√† actifs ci-dessus
  }

  function showAdminIfNeeded(){
    if(isAdmin) document.getElementById('adminPanel').style.display = 'block';
  }
</script>
</body>
</html>
