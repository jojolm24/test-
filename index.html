<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Arthur & Jojo - Site</title>
  <script src="https://www.gstatic.com/firebasejs/9.30.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.30.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.30.0/firebase-database-compat.js"></script>
  <style>
    * { box-sizing: border-box; margin:0; padding:0; }
    body { font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg,#111,#222); color:#fff; }
    header { display:flex; justify-content:space-between; align-items:center; padding:1rem 2rem; background:#111; box-shadow:0 2px 10px rgba(0,0,0,0.7); }
    .logo { font-size:1.8rem; color:#ff5f6d; }
    nav { position:relative; }
    .menu-btn { background: linear-gradient(90deg,#444,#222); border:none; padding:0.5rem 1rem; border-radius:8px; cursor:pointer; transition:0.3s; }
    .menu-btn:hover { background: linear-gradient(90deg,#555,#333); }
    .dropdown { position:absolute; right:0; top:2.8rem; display:none; flex-direction:column; background:#222; border-radius:8px; box-shadow:0 4px 10px rgba(0,0,0,0.7); overflow:hidden; }
    .dropdown.show { display:flex; }
    .login-btn { padding:0.8rem 1.2rem; background:#333; border:none; color:#fff; text-align:left; cursor:pointer; transition:0.3s; }
    .login-btn:hover { background: linear-gradient(90deg,#ff5f6d,#ffc371); color:#000; }

    .container { max-width:1000px; margin:2rem auto; padding:0 1rem; }
    section { margin-bottom:2rem; background:#1a1a1a; padding:1rem; border-radius:12px; box-shadow:0 4px 15px rgba(0,0,0,0.7); }
    h2 { margin-bottom:1rem; color:#ff5f6d; }

    .ticket-btn { background: linear-gradient(90deg,#ff5f6d,#ffc371); color:#000; padding:0.8rem 1.5rem; border:none; border-radius:12px; font-size:1.1rem; cursor:pointer; box-shadow:0 4px 15px rgba(255,193,113,0.6); transition:0.3s; }
    .ticket-btn:hover { transform: translateY(-3px); box-shadow:0 6px 20px rgba(255,193,113,0.8); }

    .video-list { display:flex; flex-direction:column; gap:1rem; }
    .video-card iframe { width:100%; height:300px; border-radius:8px; border:none; }

    .annonce { background:#333; padding:0.8rem 1rem; border-radius:8px; display:flex; justify-content:space-between; align-items:center; margin-bottom:0.5rem; }
    .delete-btn { background:#ff5f6d; border:none; padding:0.2rem 0.5rem; border-radius:5px; cursor:pointer; }

    #adminPanel { display:none; background:#222; padding:1rem; border-radius:12px; box-shadow:0 0 15px rgba(0,0,0,0.8); }
    #adminPanel input, #adminPanel textarea { width:100%; padding:0.6rem; margin-bottom:0.6rem; border:none; border-radius:6px; background:#111; color:#fff; }
    #adminPanel button { padding:0.6rem 1rem; border:none; border-radius:8px; cursor:pointer; background: linear-gradient(90deg,#ff5f6d,#ffc371); color:#000; margin-right:0.5rem; transition:0.3s; }
    #adminPanel button:hover { opacity:0.9; }

    .ticket-discussion { background:#333; padding:0.8rem; border-radius:10px; margin-bottom:1rem; }
    .ticket-message { margin-bottom:0.5rem; }
    .ticket-message span { font-weight:bold; }

    footer { text-align:center; margin-top:2rem; color:#aaa; }
  </style>
</head>
<body>

<header>
  <div class="logo">Arthur & Jojo ‚ù§Ô∏è</div>
  <nav>
    <button class="menu-btn" onclick="toggleMenu()">‚ò∞ Se connecter</button>
    <div class="dropdown" id="menuDropdown">
      <button class="login-btn" onclick="loginUser()">üë§ Utilisateur</button>
      <button class="login-btn" onclick="loginAdmin()">üõ°Ô∏è Admin</button>
    </div>
  </nav>
</header>

<div class="container">
  <section id="videosSection">
    <h2>üé• Vid√©os</h2>
    <div class="video-list" id="videoList"></div>
  </section>

  <section id="annoncesSection">
    <h2>üì¢ Annonces</h2>
    <div id="annoncesList"></div>
  </section>

  <section id="ticketsSection">
    <h2>üé´ Tickets</h2>
    <button class="ticket-btn" onclick="openTicket()">‚ûï Ouvrir un ticket</button>
    <div id="tickets"></div>
  </section>

  <section id="adminPanel">
    <h2>üõ†Ô∏è Admin Panel</h2>
    <h3>Vid√©os</h3>
    <input type="text" id="videoUrl" placeholder="URL YouTube embed">
    <textarea id="videoDesc" placeholder="Description"></textarea>
    <button onclick="adminAddVideo()">Ajouter Vid√©o</button>

    <h3>Annonces</h3>
    <textarea id="annonceText" placeholder="Nouvelle annonce"></textarea>
    <button onclick="adminAddAnnonce()">Ajouter Annonce</button>

    <h3>Tickets (admin)</h3>
    <div id="adminTickets"></div>
  </section>
</div>

<footer>Cod√© par Jojo fait avec le ‚ù§Ô∏è</footer>

<script>
  // --- Firebase init ---
  const firebaseConfig = {
    apiKey: "VOTRE_API_KEY",
    authDomain: "VOTRE_PROJET.firebaseapp.com",
    databaseURL: "https://VOTRE_PROJET.firebaseio.com",
    projectId: "VOTRE_PROJET",
    storageBucket: "VOTRE_PROJET.appspot.com",
    messagingSenderId: "VOTRE_SENDER_ID",
    appId: "VOTRE_APP_ID"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.database();

  let currentUser = null;
  let isAdmin = false;

  // --- Menu Connexion ---
  function toggleMenu() {
    document.getElementById('menuDropdown').classList.toggle('show');
  }
  window.onclick = e => {
    if (!e.target.matches('.menu-btn')) {
      document.getElementById('menuDropdown').classList.remove('show');
    }
  };

  // --- Auth Google Utilisateur ---
  function loginUser(){
    const provider = new firebase.auth.GoogleAuthProvider();
    auth.signInWithPopup(provider)
      .then(result => {
        currentUser = result.user;
        console.log("Connect√© : ", currentUser);
        loadAll();
      })
      .catch(e => { console.error(e); alert("Erreur login Google"); });
  }

  // --- Login Admin (via code) ---
  function loginAdmin(){
    const code = prompt("Entrez le code admin :");
    if(code === "2516") {
      isAdmin = true;
      document.getElementById('adminPanel').style.display = "block";
      loadAll();
      alert("Acc√®s administrateur activ√© !");
    } else {
      alert("Code incorrect.");
    }
  }

  // --- VID√âOS ---
  function adminAddVideo(){
    if(!isAdmin) return alert("Acc√®s admin requis");
    const url = document.getElementById('videoUrl').value;
    const desc = document.getElementById('videoDesc').value;
    const key = db.ref('videos').push().key;
    db.ref('videos/' + key).set({ url, desc });
    document.getElementById('videoUrl').value = "";
    document.getElementById('videoDesc').value = "";
  }

  function renderVideos(videos){
    const list = document.getElementById('videoList');
    list.innerHTML = "";
    for(const key in videos){
      const v = videos[key];
      const div = document.createElement('div');
      div.className = "video-card";
      div.innerHTML = `<iframe src="${v.url}" allowfullscreen></iframe>
                       <p>${v.desc || ""}</p>
                       ${isAdmin ? `<button onclick="deleteVideo('${key}')">Supprimer</button>` : ""}`;
      list.appendChild(div);
    }
  }

  function deleteVideo(key){
    if(!isAdmin) return;
    db.ref('videos/' + key).remove();
  }

  db.ref('videos').on('value', snapshot => {
    renderVideos(snapshot.val() || {});
  });

  // --- ANNONCES ---
  function adminAddAnnonce(){
    if(!isAdmin) return alert("Acc√®s admin requis");
    const text = document.getElementById('annonceText').value;
    const key = db.ref('annonces').push().key;
    db.ref('annonces/' + key).set({ text });
    document.getElementById('annonceText').value = "";
  }

  function renderAnnonces(annonces){
    const list = document.getElementById('annoncesList');
    list.innerHTML = "";
    for(const key in annonces){
      const a = annonces[key];
      const div = document.createElement('div');
      div.className = "annonce";
      div.innerHTML = `<span>${a.text}</span>` +
        (isAdmin ? `<button class="delete-btn" onclick="deleteAnnonce('${key}')">‚ùå</button>` : "");
      list.appendChild(div);
    }
  }

  function deleteAnnonce(key){
    if(!isAdmin) return;
    db.ref('annonces/' + key).remove();
  }

  db.ref('annonces').on('value', snapshot => {
    renderAnnonces(snapshot.val() || {});
  });

  // --- TICKETS ---
  function openTicket(){
    if(!currentUser) { alert("Connectez-vous d‚Äôabord !"); return; }
    const key = db.ref('tickets').push().key;
    db.ref('tickets/' + key).set({ user: currentUser.uid, messages: {} });
  }

  function renderTickets(tickets){
    const userDiv = document.getElementById('tickets');
    const adminDiv = document.getElementById('adminTickets');
    userDiv.innerHTML = "";
    adminDiv.innerHTML = "";

    for(const key in tickets){
      const t = tickets[key];
      if(currentUser && (t.user === currentUser.uid || isAdmin)){
        const divUser = document.createElement('div');
        divUser.className = "ticket-discussion";
        let htmlUser = `<h4>Ticket ${key}</h4>`;
        for(const mkey in t.messages){
          const m = t.messages[mkey];
          htmlUser += `<div class="ticket-message"><span>${m.from}:</span> ${m.text} ${isAdmin ? `<button onclick="deleteMessage('${key}','${mkey}')">üóëÔ∏è</button>` : ""}</div>`;
        }
        htmlUser += `<input type="text" placeholder="Message..." id="inp-${key}"/><button onclick="sendMessage('${key}')">Envoyer</button>`;
        divUser.innerHTML = htmlUser;
        userDiv.appendChild(divUser);

        if(isAdmin){
          const divAdmin = divUser.cloneNode(true);
          adminDiv.appendChild(divAdmin);
        }
      }
    }
  }

  function sendMessage(ticketKey){
    const inp = document.getElementById('inp-' + ticketKey);
    const text = inp.value.trim();
    if(!text) return;
    const msgKey = db.ref('tickets/' + ticketKey + '/messages').push().key;
    db.ref('tickets/' + ticketKey + '/messages/' + msgKey).set({
      text,
      from: isAdmin ? "Admin" : (currentUser.displayName || "User")
    });
    inp.value = "";
  }

  function deleteMessage(ticketKey, msgKey){
    if(!isAdmin) return;
    db.ref('tickets/' + ticketKey + '/messages/' + msgKey).remove();
  }

  db.ref('tickets').on('value', snapshot => {
    renderTickets(snapshot.val() || {});
  });

  // --- Load initial state ---
  auth.onAuthStateChanged(user => {
    currentUser = user;
    loadAll();
    if(isAdmin) document.getElementById('adminPanel').style.display = "block";
  });

  function loadAll(){
    // recharge vid√©os, annonces, tickets via les listeners
  }
</script>
</body>
</html>
